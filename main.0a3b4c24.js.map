{"version":3,"sources":["js/main.js"],"names":["selectElement","document","querySelector","formatDate","date","getFullYear","getMonth","slice","getDate","addEventListener","event","fetch","target","value","then","response","json","map","zippedStats","rest","attribute","flat","parsed","Tabulator","height","groupToggleElement","groupStartOpen","layout","groupBy","initialSort","column","dir","groupHeader","count","data","group","totalEarnings","forEach","item","amount","Date","Number","parseFloat","toPrecision","toFixed","columns","title","field","hozAlign","sorter","formatter","cell","formatterParams","onRendered","getValue","convertedDate","editor","headerFilter","topCalc","values","calcParams","calc","totalTime","luxon","Duration","fromMillis","shiftTo","days","toFormat","substr","formatHumanSecondsDuration","topCalcParams","precision","topCalcFormatter","topCalcFormatterParams","decimal","thousand","symbol","fieldEl","getElementById","typeEl","valueEl","customFilter","car","rating","updateFilter","filterVal","options","selectedIndex","typeVal","filter","disabled","table","setFilter","clearFilter","duration"],"mappings":"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","file":"main.0a3b4c24.js","sourceRoot":"..","sourcesContent":["const selectElement = document.querySelector(\"#dataset-url\");\n\nselectElement.addEventListener(\"change\", (event) => {\n    fetch(`${event.target.value}`)\n    .then((response) => response.json())\n    .then((json) => json.map(({zippedStats, ...rest}) => \n            zippedStats.map(attribute => ({...rest, ...attribute}))).flat())\n    .then(parsed => new Tabulator(\"#example-table\", {\n        height:311,\n        groupToggleElement:\"header\",\n        groupStartOpen:false,\n        layout:\"fitColumns\",\n        groupBy: \"periodStartedAt\",\n        initialSort:[\n            {column:\"periodStartedAt\", dir:\"desc\"}, //sort by this first\n        ],\n        groupHeader: function (value, count, data, group) {\n            let totalEarnings = 0;\n            data.forEach((item) => {\n                if (item.amount > 0) {\n                    totalEarnings += item.amount;\n                }\n            });\n    \n            return formatDate(new Date(Number(value))) + ` - $${parseFloat(totalEarnings.toPrecision(3)).toFixed(2)}`;\n        },\n        columns: [\n            {title:\"Date\", field:\"periodStartedAt\", hozAlign:\"center\", sorter:\"number\", formatter: function (cell, formatterParams, onRendered) {\n                if (cell.getValue()) {\n                    let convertedDate = formatDate(new Date(Number(cell.getValue())));\n                    return convertedDate;\n                }}\n            },\n            {title:\"Title\", field:\"title\", editor:\"input\", headerFilter:true},\n            {title:\"Name\", field:\"name\"},\n            {title:\"Link\", field:\"link\"},\n            {title:\"Views\", field:\"views\", topCalc: \"sum\"},\n            {title: \"Internal views\", field:\"internalReferrerViews\", topCalc: \"sum\"},\n            {title: \"Member time reading (s)\", field:\"memberTtr\",\n                topCalc: function (values, data, calcParams) {\n                    let calc = 0;\n                    values.forEach(function (value) {\n                        calc += value;\n                    });\n                    \n                    totalTime = luxon.Duration.fromMillis(calc * 1000).shiftTo('days', 'hours', 'minutes', 'seconds');\n        \n                    if (totalTime.days === 0) return totalTime.toFormat('hh:mm:ss');\n                    else return totalTime.days + 'd ' + totalTime.toFormat('d hh:mm:ss').substr(2);\n                },\n                formatter: formatHumanSecondsDuration,},\n            {title: \"Amount\", field:\"amount\", topCalc: \"sum\", topCalcParams: { precision: 2 },\n                topCalcFormatter: \"money\",\n                topCalcFormatterParams: {\n                    decimal: \".\",\n                    thousand: \",\",\n                    symbol: \"$\",\n                    precision: 2,\n                },\n                formatter: \"money\",\n                formatterParams: {\n                    decimal: \".\",\n                    thousand: \",\",\n                    symbol: \"$\",\n                    precision: 2,\n                }},\n\n            \n        ],\n        data: parsed\n    }))\n    //Define variables for input elements\n    var fieldEl = document.getElementById(\"filter-field\");\n    var typeEl = document.getElementById(\"filter-type\");\n    var valueEl = document.getElementById(\"filter-value\");\n\n    //Custom filter example\n    function customFilter(data){\n        return data.car && data.rating < 3;\n    }\n\n    //Trigger setFilter function with correct parameters\n    function updateFilter(){\n    var filterVal = fieldEl.options[fieldEl.selectedIndex].value;\n    var typeVal = typeEl.options[typeEl.selectedIndex].value;\n\n    var filter = filterVal == \"function\" ? customFilter : filterVal;\n\n    if(filterVal == \"function\" ){\n        typeEl.disabled = true;\n        valueEl.disabled = true;\n    }else{\n        typeEl.disabled = false;\n        valueEl.disabled = false;\n    }\n\n    if(filterVal){\n        table.setFilter(filter,typeVal, valueEl.value);\n    }\n    }\n\n    //Update filters on value change\n    document.getElementById(\"filter-field\").addEventListener(\"change\", updateFilter);\n    document.getElementById(\"filter-type\").addEventListener(\"change\", updateFilter);\n    document.getElementById(\"filter-value\").addEventListener(\"keyup\", updateFilter);\n\n    //Clear filters on \"Clear Filters\" button click\n    document.getElementById(\"filter-clear\").addEventListener(\"click\", function(){\n    fieldEl.value = \"\";\n    typeEl.value = \"=\";\n    valueEl.value = \"\";\n\n    table.clearFilter();\n    });\n\n});\n\nfunction formatDate(date) {\n    return date.getFullYear() + \"-\" +\n        ('0' + (date.getMonth() + 1)).slice(-2) + \"-\" +\n        ('0' + date.getDate()).slice(-2);\n}\n\n\nconst formatHumanSecondsDuration = function (cell) {\n    duration = luxon.Duration.fromMillis(cell.getValue() * 1000).shiftTo('days', 'hours', 'minutes', 'seconds');\n\n    if (duration.days === 0) {\n        return duration.toFormat('hh:mm:ss');\n    } else return duration.days + 'd ' + duration.toFormat('d hh:mm:ss').substr(2);\n}"]}